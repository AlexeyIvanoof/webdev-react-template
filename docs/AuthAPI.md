# Skypro.Music API Авторизции

Api для управления пользователями и авторизацией.

## Коротко

Документация в swagger:
https://painassasin.online/swagger/

| Описание запроса   | Тип запроса | Пример запроса                                 |
| ------------------ | ----------- | ---------------------------------------------- |
| Зарегистрироваться | POST        | https://painassasin.online/user/signup/        |
| Войти              | POST        | https://painassasin.online/user/login/         |
| Получить токен     | POST        | https://painassasin.online/user/token/         |
| Обновить токен     | POST        | https://painassasin.online/user/token/refresh/ |

## Подробно

### Зарегистрироваться

Адрес: https://painassasin.online/user/signup/

Метод: POST

Создает нового пользователя в системе. В теле запроса принимает объект пользователя в формате JSON. Обязательные поля для нового пользвателя `email`, `password` и `username`.

Пример запроса:

```js
fetch("https://painassasin.online/user/signup/", {
  method: "POST",
  body: JSON.stringify({
    email: "gleb@fokin.ru",
    password: "Aa12345!!",
    username: "gleb@fokin.ru",
  }),
  headers: {
    // API требует обязательного указания заголовка content-type, так апи понимает что мы посылаем ему json строчку в теле запроса
    "content-type": "application/json",
  },
})
  .then((response) => response.json())
  .then((json) => console.log(json));
```

#### 201 ответ

Пользователь успешно зарегистрирован, в теле ответа будет объект созданного пользователя:

```json
{
  "id": 666,
  "username": "gleb@fokin.ru",
  "first_name": "",
  "last_name": "",
  "email": "gleb@fokin.ru"
}
```

#### 400 ответ

Не получилось зарегистрировать пользователя с указанными данными, в теле ответа будет объект объект с ошибками регистрации:

```json
{
  "username": ["Пользователь с таким именем уже существует."],
  "email": ["Пользователь с таким адрес электронной почты уже существует."],
  "password": [
    "Введённый пароль слишком короткий. Он должен содержать как минимум 8 символов.",
    "Введённый пароль слишком широко распространён.",
    "Введённый пароль состоит только из цифр."
  ]
}
```

#### 500 ответ

Сервер сломался

### Войти

Адрес: https://painassasin.online/user/login/

Метод: POST

Возвращает данные пользователя по почте и паролю. В теле запроса принимает объект пользователя в формате JSON, обязательные поля `email` и `password`.
Пример запроса:

```js
fetch("https://painassasin.online/user/login/", {
  method: "POST",
  body: JSON.stringify({
    email: "gleb@fokin.ru",
    password: "gleb@fokin.ru",
  }),
  headers: {
    // API требует обязательного указания заголовка content-type, так апи понимает что мы посылаем ему json строчку в теле запроса
    "content-type": "application/json",
  },
})
  .then((response) => response.json())
  .then((json) => console.log(json));
```

#### 200 ответ

Пользователь успешно авторизован, в теле ответа будет объект авторизованного пользователя:

```json
{
  "id": 666,
  "username": "gleb@fokin.ru",
  "first_name": "",
  "last_name": "",
  "email": "gleb@fokin.ru"
}
```

#### 400 ответ

Запрос составлен некорректно, например не передан пароль, в теле ответа будет расшифровка проблем, такой же как в 400 ответе при регистрации.

#### 401 ответ

Запрос составлен корректно, но не получилось авторизовать пользователя, в теле ответа будет объект с причиной:

```json
{ "detail": "Пользователь с таким email или паролем не найден" }
```

#### 500 ответ

Сервер сломался

### Получить токен

Адрес: https://painassasin.online/user/token/

Метод: POST

Возвращает access и refresh токен по email и паролю пользователя.
access токен нужен для того чтобы делать авторизованные запросы в апи (например запрос на добавление в "избаранные треки").
access токеном можно пользоваться ограниченное количество времени, потом он "протухает".
Чтобы получить новый access токен, нужно сделать запрос в api "Обновить токен" с refresh токеном.
refresh токен не протухает со временем, но может протухнуть если пользователь сменит пароль или нажмет кнопку "выйти на всех устройствах".

### Обновить токен

Адрес: https://painassasin.online/user/token/refresh/

Метод: POST

Принимает refresh токен, возвращает "живой" acces токен.
